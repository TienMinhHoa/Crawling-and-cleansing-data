file = open("raw_data.txt","r")
#read file
datas = file.read().split("\n")

sbd = 2000000

for data in datas:
	
		sbd+=1
		str_sbd = "0"+str(sbd)
		if str_sbd in ["02000521","02002776","02002833","02005380","02005472","02005733","02005820","02005876","02006091","02006300","02006364","02006544","02006712","02006720","02006904","02008746","02009196","02012503","02019593","02020755","02024536","02027212","02031588","02031948","02035434","02036693","02042067","02042972","02043577","02044668","02046177","02046483","02046496","02046651","02046766","02046771","02046788","02046810","02046841","02046998","02047031","02047122","02047241","02047273","02047304","02047486","02047636","02047834","02047843","02047856","02047865","02048225","02048271","02048279","02048397","02048424","02048427","02048592","02048660","02048701","02048723","02048858","02049069","02049090","02049104","02049164","02049234","02049312","02049383","02049663","02049763","02049775","02049891","02049971","02050378","02050476","02050488","02050516","02050526","02050540","02050576","02050642","02050649","02050722","02050809","02050814","02050899","02050959","02050978","02050984","02050985","02051006","02051072","02051181","02051191","02051234","02051422","02051468","02051472","02051495","02051615","02051616","02051736","02052013","02052030","02052089","02052314","02052373","02052591","02052663","02052711","02052791","02052856","02053000","02053106","02053259","02053593","02053699","02053860","02054235","02054306","02054374","02054508","02054733","02054787","02055119","02055200","02055290","02055296","02055606","02055683","02055803","02055829","02055912","02055930","02055986","02056020","02056032","02056105","02056139","02056186","02056190","02056238","02056273","02056291","02056298","02056333","02056350","02056377","02056393","02056782","02056823","02056865","02056871","02057014","02057294","02057410","02057496","02058404","02058498","02058518","02058789","02058938","02059095","02059163","02059740","02059751","02059769","02059774","02059807","02059852","02060462","02060492","02060536","02060610","02060652","02060656","02060660","02060730","02060738","02061813","02062212","02062236","02062391","02062440","02062898","02063109","02063114","02063179","02063180","02063181","02063207","02063272","02063653","02063707","02063716","02063752","02063754","02063825","02064369","02064704","02064783","02064990","02065104","02065323","02065604","02065877","02065995","02066106","02066212","02066835","02067172","02067291","02067316","02067371","02067383","02067401","02067446","02067467","02067550","02067563","02067659","02067672","02067698","02067762","02067909","02067971","02067996","02068089","02068119","02068156","02068174","02068178","02068243","02068287","02068365","02068382","02068427","02068453","02068548","02068550","02068627","02068667","02068702","02068732","02068846","02068970","02069028","02069043","02069066","02069156","02069290","02069362","02069397","02069843","02069990","02070203","02070870","02071102","02071574","02072480","02072549","02072755","02072823","02073036","02073372","02073477","02073556","02073964","02074135","02074254","02074281","02074367","02074607"]:
			continue
		#remove some special characters
		data = data.replace("\\n","\n")
		data = data.replace("\\t","")
		data = data.replace("\\r","")

		#remove the tags
		begin = 0
		end= 0
		tmp = []
		for i in range(len(data)):
			if data[i] == '<':
				begin = i
			if data[i] == '>':
				end = i
				tmp.append(data[begin:end+1])
		for character in tmp:
			data = data.replace(character,"")

		#remove '' characters
		data = data.split("\n")
		tmp = []
		for i in range(len(data)):
			if data[i] == '':
				tmp.append(i)
		step = 0
		for i in tmp:
			data.pop(i-step)
			step += 1


		#make the unicode table
		unicode_file = open("unicode_table.txt","r",encoding="utf-8")
		unicode_table = unicode_file.read().split("\n")

		chars = []
		code = []

		for i in range(len(unicode_table)):
			unicode_table[i] = unicode_table[i][8:]
		unicode_table.pop()
		for i in range(len(unicode_table)):
			tmp = unicode_table[i]
			chars.append(tmp[0])
			code.append(tmp[3:])

		#decode the utf
		for i in range(len(data)):
			for j in range(len(code)):
				if data[i].find(code[j])!=-1:
					data[i] = data[i].replace(code[j],chars[j])


		#decode the ascii
		for i in range(len(data)):
			while(data[i].find("&#")!=-1):
				tmp = data[i].find("&#")
				data[i] = data[i].replace(data[i][tmp:tmp+6],chr(int(data[i][tmp+2:tmp+5])))




		#get the infor
		name =data[43].lstrip()
		bod = data[46].lstrip()
		score = data[49].lstrip()



		#conver to csv
		name = name.lower()

		#split bod
		bod_list = bod.split("/")
		dd = bod_list[0]
		mm = bod_list[1]
		yy = bod_list[2]

		data = [str_sbd,name,str(dd),str(mm),str(yy)]
		#scores split
		score = score.lower()
		score = score.replace("khxh: ","khxh:   ")
		score = score.replace("khtn: ","khtn:   ")
		score = score.replace(":","")
		score_list = score.split("   ")
		score_list.pop()
		for subject in ["toán","ngữ văn","khxh","khtn","lịch sử","địa lí","gdcd","sinh học","vật lí","hoá học","tiếng anh"]:
			if subject in score_list:
				data.append(str(score_list[score_list.index(subject)+1]))
			else:
				data.append(str(-1))






		#save the infor
		file = open("clean_data.txt","a",encoding = "utf8")
		for i in range(len(data)):
			file.write(str(data[i])+",")
		file.write("\n")





